<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS MCQ Study Tool</title>
    <link rel="stylesheet" href="mcq-style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AWS MCQ Study Tool</h1>
            <p>Test your knowledge with multiple choice questions</p>
        </div>

        <div class="section-selector">
            <label for="sectionSelect">Select Section:</label>
            <select id="sectionSelect">
                <option value="">-- Choose a section --</option>
                <option value="getting-started-aws/mcq-data.csv">Getting Started with AWS</option>
                <option value="iam-aws-cli/mcq-data.csv">IAM & AWS CLI</option>
                <option value="ec2-fundamentals/mcq-data.csv">EC2 Fundamentals</option>
                <option value="ec2-solution-architect/mcq-data.csv">EC2 Solution Architect Associate Level</option>
                <option value="ec2-instance-storage/mcq-data.csv">EC2 Instance Storage</option>
                <option value="elb-asg/mcq-data.csv">ELB & ASG</option>
            </select>
        </div>

        <div id="scoreboardContainer" style="display: none;">
            <div class="stats">
                <div class="stat-item">Total Questions: <span id="totalQuestions">0</span></div>
                <div class="stat-item" style="background: rgba(40, 167, 69, 0.3);">Correct: <span id="correctCount">0</span></div>
                <div class="stat-item" style="background: rgba(220, 53, 69, 0.3);">Incorrect: <span id="incorrectCount">0</span></div>
                <div class="stat-item">Score: <span id="scorePercentage">0%</span></div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%;">0%</div>
            </div>
        </div>

        <div class="controls" id="controlsContainer" style="display: none;">
            <button class="btn btn-secondary" id="resetBtn">Reset Quiz</button>
            <button class="btn btn-success" id="reviewBtn" style="display: none;">Review Wrong Answers</button>
            <button class="btn" id="nextBtn">Next Question →</button>
        </div>

        <div class="mcq-container" id="mcqContainer">
            <div style="text-align: center; color: white; padding: 50px; font-size: 1.2em;">
                Please select a section from the dropdown above to start the quiz.
            </div>
        </div>

        <div id="reviewContainer" style="display: none;">
            <div class="header">
                <h2>Review: Incorrect Answers</h2>
            </div>
            <div class="mcq-container" id="reviewQuestions"></div>
        </div>

        <div class="footer" id="footerContainer" style="display: none;">
            <p><strong>Instructions:</strong> Select an answer and click "Submit Answer" to check your response</p>
            <p>Your score and incorrect answers will be tracked automatically</p>
        </div>
    </div>

    <script>
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = {};
        let correctAnswers = {};
        let wrongAnswers = [];

        // CSV Parser
        function parseCSV(csvText) {
            const lines = csvText.trim().split(/\r?\n/);
            if (lines.length < 2) return [];
            
            const headers = parseCSVLine(lines[0]);
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;
                
                const values = parseCSVLine(lines[i]);
                
                if (values.length === headers.length) {
                    const obj = {};
                    headers.forEach((header, index) => {
                        obj[header.trim()] = values[index] ? values[index].trim() : '';
                    });
                    data.push(obj);
                }
            }
            
            return data;
        }
        
        function parseCSVLine(line) {
            const values = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const nextChar = line[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    values.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            values.push(current);
            return values;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML.replace(/\n/g, '<br>');
        }

        function loadCSV(sectionPath) {
            const container = document.getElementById('mcqContainer');
            container.innerHTML = '<div style="text-align: center; color: white; padding: 50px; font-size: 1.2em;">Loading questions...</div>';
            
            fetch(sectionPath)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(csvText => {
                    if (!csvText || csvText.trim().length === 0) {
                        throw new Error('CSV file is empty');
                    }
                    
                    const data = parseCSV(csvText);
                    
                    if (data.length === 0) {
                        throw new Error('No questions found in CSV file');
                    }
                    
                    currentQuestions = data;
                    currentQuestionIndex = 0;
                    userAnswers = {};
                    correctAnswers = {};
                    wrongAnswers = [];
                    
                    // Build correct answers map
                    data.forEach((q, index) => {
                        correctAnswers[index] = q.CorrectAnswer ? q.CorrectAnswer.trim().toUpperCase() : '';
                    });
                    
                    displayQuestion(0);
                    updateScoreboard();
                    
                    document.getElementById('scoreboardContainer').style.display = 'block';
                    document.getElementById('controlsContainer').style.display = 'block';
                    document.getElementById('footerContainer').style.display = 'block';
                    document.getElementById('reviewContainer').style.display = 'none';
                })
                .catch(error => {
                    console.error('Error loading CSV:', error);
                    container.innerHTML = `<div style="text-align: center; color: white; padding: 50px; font-size: 1.2em;">
                        Error loading questions. Please check the file path.<br><br>
                        <small style="opacity: 0.8;">Check the browser console (F12) for more details.</small>
                    </div>`;
                });
        }

        function displayQuestion(index) {
            if (index < 0 || index >= currentQuestions.length) return;
            
            currentQuestionIndex = index;
            const question = currentQuestions[index];
            const container = document.getElementById('mcqContainer');
            
            const options = ['A', 'B', 'C', 'D'].map(letter => {
                const optionText = question[`Option${letter}`] || '';
                return { letter, text: optionText };
            }).filter(opt => opt.text);
            
            const userAnswer = userAnswers[index];
            const isAnswered = userAnswer !== undefined;
            const isCorrect = userAnswer === correctAnswers[index];
            
            container.innerHTML = `
                <div class="mcq-card ${isAnswered && isCorrect ? 'done' : ''}">
                    <div class="mcq-header">
                        <div class="mcq-number">Question ${index + 1} of ${currentQuestions.length}</div>
                        ${isAnswered && isCorrect ? '<div class="mcq-done-badge">✓ Correct</div>' : ''}
                    </div>
                    <div class="mcq-question">${escapeHtml(question.Question || question.Front || '')}</div>
                    <div class="mcq-options">
                        ${options.map((opt, optIndex) => {
                            const isSelected = userAnswer === opt.letter;
                            const isCorrectOption = opt.letter === correctAnswers[index];
                            let classes = 'mcq-option';
                            
                            if (isAnswered) {
                                if (isCorrectOption) {
                                    classes += ' correct';
                                } else if (isSelected && !isCorrectOption) {
                                    classes += ' incorrect';
                                } else {
                                    classes += ' disabled';
                                }
                            } else if (isSelected) {
                                classes += ' selected';
                            }
                            
                            return `
                                <div class="${classes}" data-option="${opt.letter}" ${isAnswered ? '' : 'onclick="selectOption(\'' + opt.letter + '\')"'}>
                                    <div class="mcq-option-label">${opt.letter}.</div>
                                    <div class="mcq-option-text">${escapeHtml(opt.text)}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    ${isAnswered ? `
                        <div class="mcq-feedback ${isCorrect ? 'correct' : 'incorrect'} show">
                            ${isCorrect ? 
                                '<strong>✓ Correct!</strong> ' + escapeHtml(question.Explanation || question.Front || '') :
                                '<strong>✗ Incorrect.</strong> The correct answer is ' + correctAnswers[index] + '. ' + escapeHtml(question.Explanation || question.Front || '')
                            }
                        </div>
                    ` : ''}
                    <div class="mcq-actions">
                        ${!isAnswered ? `
                            <button class="btn" onclick="submitAnswer()">Submit Answer</button>
                        ` : ''}
                        <button class="btn btn-secondary" onclick="previousQuestion()" ${index === 0 ? 'disabled' : ''}>← Previous</button>
                        <button class="btn" onclick="nextQuestion()" ${index === currentQuestions.length - 1 ? 'disabled' : ''}>Next →</button>
                    </div>
                </div>
            `;
        }

        function selectOption(option) {
            userAnswers[currentQuestionIndex] = option;
            displayQuestion(currentQuestionIndex);
        }

        function submitAnswer() {
            if (userAnswers[currentQuestionIndex] === undefined) {
                alert('Please select an answer first!');
                return;
            }
            
            const isCorrect = userAnswers[currentQuestionIndex] === correctAnswers[currentQuestionIndex];
            
            if (!isCorrect) {
                const question = currentQuestions[currentQuestionIndex];
                wrongAnswers.push({
                    index: currentQuestionIndex,
                    question: question.Question || question.Front || '',
                    userAnswer: userAnswers[currentQuestionIndex],
                    correctAnswer: correctAnswers[currentQuestionIndex],
                    explanation: question.Explanation || question.Front || '',
                    options: {
                        A: question.OptionA || '',
                        B: question.OptionB || '',
                        C: question.OptionC || '',
                        D: question.OptionD || ''
                    }
                });
            }
            
            displayQuestion(currentQuestionIndex);
            updateScoreboard();
        }

        function nextQuestion() {
            if (currentQuestionIndex < currentQuestions.length - 1) {
                displayQuestion(currentQuestionIndex + 1);
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                displayQuestion(currentQuestionIndex - 1);
            }
        }

        function updateScoreboard() {
            const total = currentQuestions.length;
            const correct = Object.keys(userAnswers).filter(i => userAnswers[i] === correctAnswers[i]).length;
            const incorrect = Object.keys(userAnswers).filter(i => userAnswers[i] !== correctAnswers[i]).length;
            const answered = Object.keys(userAnswers).length;
            const score = total > 0 ? Math.round((correct / answered) * 100) : 0;
            
            document.getElementById('totalQuestions').textContent = total;
            document.getElementById('correctCount').textContent = correct;
            document.getElementById('incorrectCount').textContent = incorrect;
            document.getElementById('scorePercentage').textContent = answered > 0 ? score + '%' : '0%';
            
            const progress = total > 0 ? (answered / total) * 100 : 0;
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = progress + '%';
            progressFill.textContent = Math.round(progress) + '%';
            
            if (wrongAnswers.length > 0) {
                document.getElementById('reviewBtn').style.display = 'inline-block';
            }
        }

        function resetQuiz() {
            if (confirm('Are you sure you want to reset the quiz? All progress will be lost.')) {
                userAnswers = {};
                wrongAnswers = [];
                currentQuestionIndex = 0;
                displayQuestion(0);
                updateScoreboard();
                document.getElementById('reviewContainer').style.display = 'none';
                document.getElementById('mcqContainer').style.display = 'block';
            }
        }

        function showReview() {
            const reviewContainer = document.getElementById('reviewContainer');
            const mcqContainer = document.getElementById('mcqContainer');
            const reviewQuestions = document.getElementById('reviewQuestions');
            
            reviewContainer.style.display = 'block';
            mcqContainer.style.display = 'none';
            
            reviewQuestions.innerHTML = wrongAnswers.map((wrong, idx) => {
                const options = ['A', 'B', 'C', 'D'].map(letter => {
                    const optionText = wrong.options[`Option${letter}`] || wrong.options[letter] || '';
                    const isCorrect = letter === wrong.correctAnswer;
                    const isUserAnswer = letter === wrong.userAnswer;
                    
                    let classes = 'mcq-option';
                    if (isCorrect) classes += ' correct';
                    if (isUserAnswer && !isCorrect) classes += ' incorrect';
                    
                    return `
                        <div class="${classes}">
                            <div class="mcq-option-label">${letter}.</div>
                            <div class="mcq-option-text">${escapeHtml(optionText)}</div>
                        </div>
                    `;
                }).join('');
                
                return `
                    <div class="mcq-card">
                        <div class="mcq-header">
                            <div class="mcq-number">Question ${wrong.index + 1}</div>
                        </div>
                        <div class="mcq-question">${escapeHtml(wrong.question)}</div>
                        <div class="mcq-options">
                            ${options}
                        </div>
                        <div class="mcq-feedback incorrect show">
                            <strong>Your Answer:</strong> ${wrong.userAnswer} (Incorrect)<br>
                            <strong>Correct Answer:</strong> ${wrong.correctAnswer}<br><br>
                            <strong>Explanation:</strong> ${escapeHtml(wrong.explanation)}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Section selector event
        document.getElementById('sectionSelect').addEventListener('change', function(e) {
            if (e.target.value) {
                loadCSV(e.target.value);
            }
        });

        // Button events
        document.getElementById('resetBtn').addEventListener('click', resetQuiz);
        document.getElementById('reviewBtn').addEventListener('click', showReview);
        document.getElementById('nextBtn').addEventListener('click', nextQuestion);

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
                nextQuestion();
            } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
                previousQuestion();
            }
        });
    </script>
</body>
</html>

